
# E2E テスト計画（C# PoC / AI-reStarter）

## 目的
MVP受け入れ要件に基づき、Windows環境での **DPI/マルチモニタ対応**、**座標オペレーションの確実性**、**キー・マウス操作の信頼性**、**テンプレート生成/管理**、**ガード/ログ/安全停止** を一貫して検証する。

## スコープ
- アプリ: AIReStarter（.NET 8 / WPF）
- 実行環境: Windows 11 22H2 以降（DPI 100%/125%/150%）、単/複数モニタ構成（左/右/上下配置）
- チャットクライアント: 対象アプリ（例: Teams/Slack など）※送信仕様差異の考慮

## 前提条件
- `profiles.toml` が作成済み（テンプレート、ROI、モニタ、閾値、ガード、ホットキー設定）
- ビルド/テスト成功 (`dotnet build --no-restore`, `dotnet test --no-build`)
- ログ出力: `logs/app.log` が有効（Serilog ローテーション設定）
- ホットキー: Ctrl+Alt+P（停止/再開）、Ctrl+Alt+Q（安全終了）

## テスト項目（シナリオ一覧）

### 1. クリック精度（DPIスケーリング）
**目的**: DPI 125%/150% 時に指定座標クリックが ±2px 以内でヒットすることを確認。
- 前提: 主モニタ DPI を 125% に設定。対象UIのボタン矩形座標を `profiles.toml` に定義。
- 手順:
  1. アプリ起動→対象UIを前面→座標クリック実行（矩形中央/四隅）。
  2. 実際の UI 応答（ボタン反応/状態変化）を確認。
- 期待結果: 誤差 ±2px 以内、クリックに伴う UI 応答が正しく発生。
- 記録: クリック座標、UI座標、誤差(px)、ログ抜粋。

### 2. 負座標（左側サブモニタ）クリック
**目的**: 仮想スクリーン基準で負座標を含むクリックが成功することを確認。
- 前提: 左にサブモニタ配置（主モニタ右）。対象UIを左モニタに配置。
- 手順: `profiles.toml` のモニタ/ROI 設定を左モニタに切替→座標クリック実行。
- 期待結果: クリック成功、ログに正しい仮想座標/物理座標が記録。
- 記録: 実座標、仮想座標、成功/失敗、ログ抜粋。

### 3. キーボード送出（IME影響）
**目的**: IME ON/OFF に関わらず ASCII コマンド送出が乱れないことを確認。
- 前提: チャット画面を前面、IME を ON に設定。
- 手順: 指定キーシーケンス/テキスト送出→送信。
- 期待結果: 入力文字列が崩れない、送信が仕様通り（Enter/CTRL+Enter）。
- 記録: 入力前後テキスト、IME 状態、送信結果、ログ抜粋。

### 4. チャットコマンド送信（ウィンドウ指定）
**目的**: ウィンドウタイトル/プロセス名確認後にチャットコマンドが確実に送信されること。
- 前提: 対象アプリのウィンドウタイトル/プロセス名を `profiles.toml` に定義。
- 手順: フォーカス移動→テキスト送出→送信→受信側で反映確認。
- 期待結果: 誤送信なし、期待するウィンドウのみが対象。
- 記録: 指定タイトル/プロセス、送信結果、ログ抜粋。

### 5. テンプレート生成（矩形キャプチャ）
**目的**: ROI 選択→テンプレート保存→一致判定→アクション発火までの流れが動作すること。
- 前提: 管理エリアから矩形キャプチャを実行可能。
- 手順: ROI選択→テンプレ保存→テンプレ一覧表示→一致判定→クリック発火。
- 期待結果: テンプレ保存ファイル生成、一致距離が閾値以下、アクションが一度のみ発火（ガード適用）。
- 記録: 保存パス、距離値、アクション実行ログ、ガード状態。

### 6. ガード/安全停止/ログ
**目的**: 連続一致 N 回のデバウンス、クールダウン抑制、ホットキー停止、ログローテーションを確認。
- 前提: `consecutive_required` と `cooldown_ms` を設定。
- 手順: テンプレ一致を連続発生→アクション→クールダウン中に再一致→ホットキー停止/再開→安全終了。
- 期待結果: 連続一致でのみ発火、クールダウン中は発火しない、ホットキーが即時に効く、ログがローテーション。
- 記録: 一致回数、発火タイムスタンプ、停止/再開イベント、ログファイル一覧。

## 合否判定
- 受け入れ要件（MVP基準）をすべて満たした場合 **Pass**。
- 未達項目がある場合 **Fail**（PoC扱い）。

## 付録
- 設備構成図（モニタ配置図）
- `profiles.toml` サンプル（実際の値は伏せ字可）
- ログサンプル
