# C#版PoC開発ガイドライン

## 目的
停止した処理を確実に再開するためのWindows専用常駐アプリを作る。

## 優先度
1. DPIスケーリング対応
2. マルチモニタ対応（負の座標含む）
3. キー入力・マウス操作の信頼性（IME含む）
4. 安全な停止手段（ホットキー）
5. ログとガード（連続一致・クールダウン）

## 条件
- 実行速度や省メモリは重要ではない。
- Windows専用でよい。クロスプラットフォームは不要。
- UI AutomationやSendInputを使える言語を優先。
- C#を第一候補とする。

## 実装方針
- 画面キャプチャ＋マッチングは簡潔に。
- 座標補正・DPI対応・マルチモニタ対応を重点的に。
- アクションはAPIではなく、キー入力・クリックで確実に。

---

## MVPで満たすべき基本機能
1. 座標オペレーションの確実性
2. キーボード操作の確実性
3. チャット画面へのコマンド送信
4. テンプレート生成（インタラクティブ）
5. 管理エリアの設定
6. 安全設計（ホットキー停止、ガード、ログ）

## PoCでの到達点
- 画面キャプチャが安定取得できる
- 座標取得・補正（DPI・負座標）が破綻なく動く
- 基本アクション（クリック・キー送出）が最小ケースで成功
- テンプレマッチの粗判定でイベントトリガが作れる
- ログ／基本ガードが機能する

---

## 受け入れ基準（Acceptance Criteria）
### 座標・DPI・モニタ
- [ ] DPI125%/150%でクリック誤差±2px以内
- [ ] 負座標のクリック成功
- [ ] モニタ切替でROIキャプチャとアクション対象切替

### キー入力・チャット送信
- [ ] ウィンドウタイトル一致後にキー送出成功
- [ ] Enter送信やCtrl+Enter送信が正しく動作
- [ ] IME ON/OFFでもASCIIコマンドが乱れない

### テンプレート生成・管理
- [ ] ROIキャプチャ→保存
- [ ] テンプレート一覧・差し替え・削除
- [ ] テンプレート単位で閾値や対象モニタ設定

### ガード・安全性
- [ ] N回連続一致でのみ発火
- [ ] クールダウン中は再発火抑制
- [ ] グローバルホットキーで停止可能

### ログ
- [ ] 作動ログをローテーションで保存
- [ ] エラー時の再試行orスキップが追跡可能

---

## テスト計画
### 環境バリエーション
- DPI: 100% / 125% / 150%
- 配置: 単モニタ、デュアル（左/右/上下）
- チャットアプリ: 送信仕様違い含む

### シナリオ
1. クリック精度テスト
2. 負座標テスト
3. IME影響テスト
4. テンプレ生成テスト
5. ホットキー停止テスト
6. ログ・ローテーションテスト

---

## Copilotへの追加指示
- MVPの受け入れ基準を満たすまでがMVP。未達ならPoC扱い。
- テストシナリオに基づく検証を `docs/docs_test_report.md` に記録。
- 設定UIはMVP含む。最低限の構成（テンプレ管理、ROI、モニタ、閾値、ガード、ホットキー）。
- ログ設計はローテーション前提。
- securityの品質ルールがCIで通ること。
