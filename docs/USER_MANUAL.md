# AI reStarter ユーザーマニュアル

## 目次
1. [概要](#概要)
2. [インストール](#インストール)
3. [初期設定](#初期設定)
4. [基本操作](#基本操作)
5. [詳細設定](#詳細設定)
6. [トラブルシューティング](#トラブルシューティング)
7. [FAQ](#faq)

## 概要

AI reStarterは、AI統合IDEでエラーや停止が発生した際に、画面を自動監視して復旧アクションを実行するツールです。

### 主な機能
- **自動監視**: 画面を定期的にキャプチャして状態を検出
- **自動復旧**: エラー検出時に適切な復旧アクションを実行
- **テンプレート管理**: エラー画面のパターンを登録・管理
- **ホットキー操作**: キーボードショートカットで手動操作

## インストール

### 必要な環境
- Windows 10/11
- Python 3.11以上
- 管理者権限（初回インストール時のみ）

### インストール手順

1. **リポジトリのクローン**
```bash
git clone <repository-url>
cd AI_reStarter
```

2. **仮想環境の作成**
```bash
python -m venv venv
venv\Scripts\activate
```

3. **依存関係のインストール**
```bash
pip install -e ".[dev]"
```

4. **動作確認**
```bash
python main.py
```

## 初期設定

### 1. アプリケーションの起動

デスクトップのショートカットまたはコマンドラインから起動：
```bash
python main.py
```

### 2. 基本設定の確認

初回起動時に以下を確認してください：

#### 監視間隔の設定
- **推奨値**: 2.0秒
- **用途**: 頻繁な監視が必要な場合は1.0秒、軽量な監視の場合は3.0秒

#### 復旧設定
- **最大試行回数**: 3回（推奨）
- **クールダウン時間**: 30秒（推奨）

### 3. 監視エリアの設定

**重要**: マルチモニター環境では、AI-IDEをメインディスプレイに配置してください。

1. メインウィンドウの「設定」タブを開く
2. 「監視エリア設定」ボタンをクリック
3. AI-IDEのエラー表示エリアを選択
4. 設定を保存

### 4. テンプレートの登録

エラー検出用のテンプレートを登録します：

1. 「テンプレート管理」タブを開く
2. 「新規テンプレート作成」をクリック
3. エラー画面の特徴的な部分を選択
4. テンプレート名を入力して保存

## 基本操作

### メインウィンドウの構成

#### 1. 監視タブ
- **監視開始/停止**: 自動監視の制御
- **現在の状態**: リアルタイムの監視状況表示
- **最後の検出**: 最新の検出結果表示

#### 2. テンプレート管理タブ
- **テンプレート一覧**: 登録済みテンプレートの表示
- **新規作成**: 新しいテンプレートの作成
- **編集/削除**: 既存テンプレートの管理

#### 3. 設定タブ
- **基本設定**: 監視間隔、復旧設定
- **詳細設定**: 高度なオプション
- **ログ設定**: ログレベルの調整

#### 4. ログタブ
- **リアルタイムログ**: 動作状況の詳細表示
- **ログ検索**: 特定の情報の検索
- **ログエクスポート**: ログファイルの保存

### ホットキー操作

アプリケーション実行中に以下のキーが使用できます：

| キー組み合わせ | 機能 |
|---|---|
| `Ctrl+Alt+S` | 現在の画面からテンプレート保存 |
| `Ctrl+Alt+R` | 手動で復旧アクション実行 |
| `Ctrl+Alt+P` | 監視の一時停止/再開 |
| `Ctrl+Alt+Q` | 監視停止 |

### 基本的な使用フロー

1. **準備**
   - AI-IDEを起動
   - AI reStarterを起動
   - 監視エリアを設定

2. **テンプレート作成**
   - エラーが発生した画面でテンプレート作成
   - 複数のエラーパターンを登録

3. **監視開始**
   - 「監視開始」ボタンをクリック
   - ログで動作状況を確認

4. **自動復旧**
   - エラー検出時に自動でアクション実行
   - 必要に応じて手動介入

## 詳細設定

### 設定ファイル（kiro_config.json）

```json
{
  "monitor_interval": 2.0,
  "action_delay": 0.5,
  "max_recovery_attempts": 3,
  "recovery_cooldown": 30,
  "template_threshold": 0.8,
  "recovery_commands": [
    "続行してください",
    "エラーを修正して続行"
  ],
  "custom_commands": {
    "compilation_error": "コンパイルエラーを修正して続行してください"
  }
}
```

### 設定項目の詳細

#### 監視設定
- **monitor_interval**: 画面キャプチャの間隔（秒）
- **template_threshold**: テンプレートマッチングの信頼度（0.0-1.0）
- **monitor_region**: 監視エリアの座標 [x, y, width, height]

#### 復旧設定
- **max_recovery_attempts**: 最大復旧試行回数
- **recovery_cooldown**: 復旧試行間の待機時間（秒）
- **action_delay**: アクション間の遅延時間（秒）

#### コマンド設定
- **recovery_commands**: デフォルトの復旧コマンド
- **custom_commands**: エラータイプ別のカスタムコマンド

### AmazonQ固有の設定

#### 実行ボタンの検出
- テンプレートファイル: `amazonq_templates/run_button.png`
- 検出閾値: 0.8（推奨）
- クリック位置: ボタンの中央

#### チャット入力の設定
- 入力欄の座標を正確に設定
- 日本語入力の考慮
- 送信方法の選択（Enter/ボタンクリック）

## トラブルシューティング

### よくある問題と解決方法

#### 1. 画面キャプチャが真っ黒になる

**原因**: マルチモニター環境での座標問題

**解決方法**:
1. AI-IDEをメインディスプレイに移動
2. Windowsの設定で「メインディスプレイを左側に配置」
3. 監視エリアを再設定

#### 2. テンプレートマッチングが動作しない

**原因**: テンプレートの品質や閾値の問題

**解決方法**:
1. テンプレート画像を再作成（より特徴的な部分を選択）
2. 閾値を0.7-0.9の範囲で調整
3. 画面解像度やスケーリングを確認

#### 3. 復旧アクションが実行されない

**原因**: 座標設定やタイミングの問題

**解決方法**:
1. チャット入力欄の座標を再設定
2. アクション間の遅延時間を増加
3. AI-IDEウィンドウが前面にあることを確認

#### 4. ホットキーが動作しない

**原因**: 権限や他のアプリケーションとの競合

**解決方法**:
1. 管理者権限で実行しない（通常権限で実行）
2. 他のアプリケーションのホットキーと競合していないか確認
3. キーボードフックの再初期化

#### 5. メモリ使用量が増加し続ける

**原因**: 画像データのメモリリーク

**解決方法**:
1. アプリケーションを再起動
2. 監視間隔を長くする
3. テンプレート数を削減

### ログの確認方法

#### ログファイルの場所
- メインログ: `ai_restarter.log`
- 復旧ログ: `kiro_recovery.log`

#### ログレベルの設定
```python
# DEBUG: 詳細な動作情報
# INFO: 一般的な動作情報
# WARNING: 警告メッセージ
# ERROR: エラー情報
# CRITICAL: 重大なエラー
```

#### 有用なログメッセージ
- `画面キャプチャを実行`: 正常な監視動作
- `テンプレートマッチング結果`: 検出状況
- `復旧アクションを実行`: 自動復旧の実行
- `エラーが発生しました`: 問題の詳細

## FAQ

### Q1: どのAI-IDEに対応していますか？
**A**: 現在はAmazonQ Developerに最適化されていますが、プラグイン形式で他のAI-IDEにも対応可能です。

### Q2: 複数のAI-IDEを同時に監視できますか？
**A**: 現在は単一のAI-IDEの監視に対応しています。複数監視は将来のバージョンで対応予定です。

### Q3: テンプレートはどのくらい作成すべきですか？
**A**: 一般的なエラーパターン3-5個程度から始めて、必要に応じて追加することを推奨します。

### Q4: 監視間隔はどのくらいに設定すべきですか？
**A**: 2.0秒が推奨です。頻繁なエラーが発生する場合は1.0秒、軽量な監視の場合は3.0秒に調整してください。

### Q5: 設定をバックアップする方法は？
**A**: `kiro_config.json`ファイルと`error_templates/`、`amazonq_templates/`フォルダをコピーしてください。

### Q6: アンインストール方法は？
**A**:
1. アプリケーションを終了
2. プロジェクトフォルダを削除
3. 必要に応じて仮想環境を削除

### Q7: 商用利用は可能ですか？
**A**: MITライセンスのため、商用利用可能です。詳細はLICENSEファイルを確認してください。

### Q8: 機能要望やバグ報告はどこに？
**A**: GitHubのIssuesページで報告してください。ログファイルも添付していただけると助かります。

---

## サポート情報

### ドキュメント
- [README.md](../README.md): 基本情報
- [FEATURES.md](../FEATURES.md): 機能詳細
- [RELEASE_NOTES.md](../RELEASE_NOTES.md): リリース情報

### 技術サポート
- GitHub Issues: バグ報告・機能要望
- ログファイル: 問題の詳細分析用

### コミュニティ
- 使用例の共有
- テンプレートの共有
- 改善提案

---

**注意**: このソフトウェアはアルファ版です。重要な作業での使用前に十分なテストを行ってください。
